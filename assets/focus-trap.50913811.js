import{_ as e}from"./index.88f3c51b.js";import{E as t}from"./aria.66f3f71c.js";import{as as n,bN as o,ao as r,a4 as s,k as a,aA as c,aY as u,x as d,al as f,aF as i}from"./todo.9d8ad3e1.js";import{c as p}from"./style.83568f4e.js";function l(e){return null==e}let m=[];const v=e=>{const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0||e===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t},E=(e,t)=>{for(const n of e)if(!y(n,t))return n},y=(e,t)=>{if("hidden"===getComputedStyle(e).visibility)return!0;for(;e;){if(t&&e===t)return!1;if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1},h=(e,t)=>{if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&(e=>e instanceof HTMLInputElement&&"select"in e)(e)&&t&&e.select()}};function T(e,t){const n=[...e],o=e.indexOf(t);return-1!==o&&n.splice(o,1),n}const L=(()=>{let e=[];return{push:t=>{const n=e[0];n&&t!==n&&n.pause(),e=T(e,t),e.unshift(t)},remove:t=>{var n,o;e=T(e,t),null==(o=null==(n=e[0])?void 0:n.resume)||o.call(n)}}})(),b={cancelable:!0,bubbles:!1},w=Symbol("elFocusTrap");var g=e(s({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:["focusAfterTrapped","focusAfterReleased","focusin","focusout","focusout-prevented","release-requested"],setup(e,{emit:s}){const i=a();let y,T;(e=>{const s=e=>{const n=e;n.key===t.esc&&m.forEach((e=>e(n)))};n((()=>{0===m.length&&document.addEventListener("keydown",s),o&&m.push(e)})),r((()=>{m=m.filter((t=>t!==e)),0===m.length&&o&&document.removeEventListener("keydown",s)}))})((t=>{e.trapped&&!g.paused&&s("release-requested",t)}));const g={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},F=n=>{if(!e.loop&&!e.trapped)return;if(g.paused)return;const{key:o,altKey:r,ctrlKey:a,metaKey:c,currentTarget:u,shiftKey:d}=n,{loop:f}=e,i=o===t.tab&&!r&&!a&&!c,p=document.activeElement;if(i&&p){const e=u,[t,o]=(e=>{const t=v(e);return[E(t,e),E(t.reverse(),e)]})(e);t&&o?d||p!==o?d&&[t,e].includes(p)&&(n.preventDefault(),f&&h(o,!0),s("focusout-prevented")):(n.preventDefault(),f&&h(t,!0),s("focusout-prevented")):p===e&&(n.preventDefault(),s("focusout-prevented"))}};c(w,{focusTrapRef:i,onKeydown:F}),u((()=>e.focusTrapEl),(e=>{e&&(i.value=e)}),{immediate:!0}),u([i],(([e],[t])=>{e&&(e.addEventListener("keydown",F),e.addEventListener("focusin",K),e.addEventListener("focusout",S)),t&&(t.removeEventListener("keydown",F),t.removeEventListener("focusin",K),t.removeEventListener("focusout",S))}));const N=e=>{s("focusAfterTrapped",e)},k=e=>s("focusAfterReleased",e),K=t=>{const n=d(i);if(!n)return;const o=t.target,r=o&&n.contains(o);r&&s("focusin",t),g.paused||e.trapped&&(r?T=o:h(T,!0))},S=t=>{const n=d(i);if(!g.paused&&n)if(e.trapped){const o=t.relatedTarget;l(o)||n.contains(o)||setTimeout((()=>{!g.paused&&e.trapped&&h(T,!0)}),0)}else{const e=t.target;e&&n.contains(e)||s("focusout",t)}};async function I(){await f();const t=d(i);if(t){L.push(g);const n=document.activeElement;y=n;if(!t.contains(n)){const o=new Event("focus-trap.focus-after-trapped",b);t.addEventListener("focus-trap.focus-after-trapped",N),t.dispatchEvent(o),o.defaultPrevented||f((()=>{let o=e.focusStartEl;p(o)||(h(o),document.activeElement!==o&&(o="first")),"first"===o&&((e,t=!1)=>{const n=document.activeElement;for(const o of e)if(h(o,t),document.activeElement!==n)return})(v(t),!0),document.activeElement!==n&&"container"!==o||h(t)}))}}}function A(){const e=d(i);if(e){e.removeEventListener("focus-trap.focus-after-trapped",N);const t=new Event("focus-trap.focus-after-released",b);e.addEventListener("focus-trap.focus-after-released",k),e.dispatchEvent(t),t.defaultPrevented||h(null!=y?y:document.body,!0),e.removeEventListener("focus-trap.focus-after-released",N),L.remove(g)}}return n((()=>{e.trapped&&I(),u((()=>e.trapped),(e=>{e?I():A()}))})),r((()=>{e.trapped&&A()})),{onKeydown:F}}}),[["render",function(e,t,n,o,r,s){return i(e.$slots,"default",{handleKeydown:e.onKeydown})}],["__file","/home/runner/work/element-plus/element-plus/packages/components/focus-trap/src/focus-trap.vue"]]);export{g as E,w as F,l as i};
