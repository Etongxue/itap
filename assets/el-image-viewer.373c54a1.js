var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,o=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,i=(e,a)=>{for(var l in a||(a={}))s.call(a,l)&&o(e,l,a[l]);if(t)for(var l of t(a))n.call(a,l)&&o(e,l,a[l]);return e},r=(e,t)=>a(e,l(t));import{bN as c,bP as u,a4 as d,m as f,k as v,a as p,n as m,Q as b,aY as y,al as g,as as k,ay as w,U as h,a2 as x,b1 as O,X as I,A as z,x as C,bp as _,V as j,W as E,I as T,aI as L,aE as N,b3 as S,bn as A,C as $,aF as P,b6 as Y,T as B,bO as D,aS as M,ak as X,D as F,b$ as R}from"./todo.9d8ad3e1.js";import{b as V,d as W,E as H,_ as q,w as G,i as K}from"./index.88f3c51b.js";import{k as Q,s as U,b as Z,m as J,n as ee,z as ae,o as le,r as te,p as se}from"./icon.b571cc89.js";import{m as ne}from"./typescript.72bf8adc.js";import{u as oe}from"./index.b2ab0f23.js";import{u as ie,m as re}from"./index.6fb72867.js";import{u as ce}from"./index.172974c9.js";import{E as ue}from"./aria.66f3f71c.js";import{t as de}from"./throttle.8deae385.js";import{u as fe}from"./index.469ed053.js";import{i as ve}from"./position.c5cd7449.js";import{c as pe}from"./style.83568f4e.js";import{g as me}from"./scroll.d4cf4dfc.js";const be=V({urlList:{type:W(Array),default:()=>ne([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:{type:Boolean,default:!1},teleported:{type:Boolean,default:!1},closeOnPressEscape:{type:Boolean,default:!0}}),ye={close:()=>!0,switch:e=>u(e)},ge=["src"];const ke=G(q(d(r(i({},{name:"ElImageViewer"}),{props:be,emits:ye,setup(e,{emit:a}){const l=e,t={CONTAIN:{name:"contain",icon:f(Q)},ORIGINAL:{name:"original",icon:f(U)}},s=c&&/firefox/i.test(window.navigator.userAgent)?"DOMMouseScroll":"mousewheel",{t:n}=oe(),o=ie("image-viewer"),{nextZIndex:d}=ce(),M=v(),X=v([]),F=p(),R=v(!0),V=v(l.initialIndex),W=m(t.CONTAIN),q=v({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),G=b((()=>{const{urlList:e}=l;return e.length<=1})),K=b((()=>0===V.value)),ne=b((()=>V.value===l.urlList.length-1)),fe=b((()=>l.urlList[V.value])),ve=b((()=>{const{scale:e,deg:a,offsetX:l,offsetY:s,enableTransition:n}=q.value;let o=l/e,i=s/e;switch(a%360){case 90:case-270:[o,i]=[i,-o];break;case 180:case-180:[o,i]=[-o,-i];break;case 270:case-90:[o,i]=[-i,o]}const r={transform:`scale(${e}) rotate(${a}deg) translate(${o}px, ${i}px)`,transition:n?"transform .3s":""};return W.value.name===t.CONTAIN.name&&(r.maxWidth=r.maxHeight="100%"),r})),pe=b((()=>u(l.zIndex)?l.zIndex:d()));function me(){F.stop(),a("close")}function be(){R.value=!1}function ye(e){R.value=!1,e.target.alt=n("el.image.error")}function ke(e){if(R.value||0!==e.button||!M.value)return;q.value.enableTransition=!1;const{offsetX:a,offsetY:l}=q.value,t=e.pageX,s=e.pageY,n=de((e=>{q.value=r(i({},q.value),{offsetX:a+e.pageX-t,offsetY:l+e.pageY-s})})),o=D(document,"mousemove",n);D(document,"mouseup",(()=>{o()})),e.preventDefault()}function we(){q.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function he(){if(R.value)return;const e=re(t),a=Object.values(t),l=W.value.name,s=(a.findIndex((e=>e.name===l))+1)%e.length;W.value=t[e[s]],we()}function xe(){if(K.value&&!l.infinite)return;const e=l.urlList.length;V.value=(V.value-1+e)%e}function Oe(){if(ne.value&&!l.infinite)return;const e=l.urlList.length;V.value=(V.value+1)%e}function Ie(e,a={}){if(R.value)return;const{zoomRate:l,rotateDeg:t,enableTransition:s}=i({zoomRate:1.4,rotateDeg:90,enableTransition:!0},a);switch(e){case"zoomOut":q.value.scale>.2&&(q.value.scale=Number.parseFloat((q.value.scale/l).toFixed(3)));break;case"zoomIn":q.value.scale<7&&(q.value.scale=Number.parseFloat((q.value.scale*l).toFixed(3)));break;case"clockwise":q.value.deg+=t;break;case"anticlockwise":q.value.deg-=t}q.value.enableTransition=s}return y(fe,(()=>{g((()=>{const e=X.value[0];(null==e?void 0:e.complete)||(R.value=!0)}))})),y(V,(e=>{we(),a("switch",e)})),k((()=>{var e,a;!function(){const e=de((e=>{switch(e.code){case ue.esc:l.closeOnPressEscape&&me();break;case ue.space:he();break;case ue.left:xe();break;case ue.up:Ie("zoomIn");break;case ue.right:Oe();break;case ue.down:Ie("zoomOut")}})),a=de((e=>{Ie((e.wheelDelta?e.wheelDelta:-e.detail)>0?"zoomIn":"zoomOut",{zoomRate:1.2,enableTransition:!1})}));F.run((()=>{D(document,"keydown",e),D(document,s,a)}))}(),null==(a=null==(e=M.value)?void 0:e.focus)||a.call(e)})),(e,a)=>(w(),h(B,{to:"body",disabled:!e.teleported},[x(Y,{name:"viewer-fade",appear:""},{default:O((()=>[I("div",{ref_key:"wrapper",ref:M,tabindex:-1,class:z(C(o).e("wrapper")),style:$({zIndex:C(pe)})},[I("div",{class:z(C(o).e("mask")),onClick:a[0]||(a[0]=_((a=>e.hideOnClickModal&&me()),["self"]))},null,2),j(" CLOSE "),I("span",{class:z([C(o).e("btn"),C(o).e("close")]),onClick:me},[x(C(H),null,{default:O((()=>[x(C(Z))])),_:1})],2),j(" ARROW "),C(G)?j("v-if",!0):(w(),E(T,{key:0},[I("span",{class:z([C(o).e("btn"),C(o).e("prev"),C(o).is("disabled",!e.infinite&&C(K))]),onClick:xe},[x(C(H),null,{default:O((()=>[x(C(J))])),_:1})],2),I("span",{class:z([C(o).e("btn"),C(o).e("next"),C(o).is("disabled",!e.infinite&&C(ne))]),onClick:Oe},[x(C(H),null,{default:O((()=>[x(C(ee))])),_:1})],2)],64)),j(" ACTIONS "),I("div",{class:z([C(o).e("btn"),C(o).e("actions")])},[I("div",{class:z(C(o).e("actions__inner"))},[x(C(H),{onClick:a[1]||(a[1]=e=>Ie("zoomOut"))},{default:O((()=>[x(C(ae))])),_:1}),x(C(H),{onClick:a[2]||(a[2]=e=>Ie("zoomIn"))},{default:O((()=>[x(C(le))])),_:1}),I("i",{class:z(C(o).e("actions__divider"))},null,2),x(C(H),{onClick:he},{default:O((()=>[(w(),h(L(C(W).icon)))])),_:1}),I("i",{class:z(C(o).e("actions__divider"))},null,2),x(C(H),{onClick:a[3]||(a[3]=e=>Ie("anticlockwise"))},{default:O((()=>[x(C(te))])),_:1}),x(C(H),{onClick:a[4]||(a[4]=e=>Ie("clockwise"))},{default:O((()=>[x(C(se))])),_:1})],2)],2),j(" CANVAS "),I("div",{class:z(C(o).e("canvas"))},[(w(!0),E(T,null,N(e.urlList,((e,a)=>S((w(),E("img",{ref_for:!0,ref:e=>X.value[a]=e,key:e,src:e,style:$(C(ve)),class:z(C(o).e("img")),onLoad:be,onError:ye,onMousedown:ke},null,46,ge)),[[A,a===V.value]]))),128))],2),P(e.$slots,"default")],6)])),_:3})],8,["disabled"]))}})),[["__file","/home/runner/work/element-plus/element-plus/packages/components/image-viewer/src/image-viewer.vue"]])),we=V({hideOnClickModal:{type:Boolean,default:!1},src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:{type:Boolean,default:!1},scrollContainer:{type:W([String,Object])},previewSrcList:{type:W(Array),default:()=>ne([])},previewTeleported:{type:Boolean,default:!1},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0}}),he={load:e=>e instanceof Event,error:e=>e instanceof Event,switch:e=>u(e),close:()=>!0},xe=["src","loading"],Oe={key:0};const Ie=G(q(d(r(i({},{name:"ElImage",inheritAttrs:!1}),{props:we,emits:he,setup(e,{emit:a}){const l=e;let t="";const{t:s}=oe(),n=ie("image"),o=M(),i=fe(),r=v(),u=v(!1),d=v(!0),f=v(!1),p=v(),m=v(),x=c&&"loading"in HTMLImageElement.prototype;let _,L;const N=b((()=>o.style)),S=b((()=>{const{fit:e}=l;return c&&e?{objectFit:e}:{}})),A=b((()=>{const{previewSrcList:e}=l;return Array.isArray(e)&&e.length>0})),Y=b((()=>{const{previewSrcList:e,initialIndex:a}=l;let t=a;return a>e.length-1&&(t=0),t})),B=b((()=>"eager"!==l.loading&&(!x&&"lazy"===l.loading||l.lazy))),V=()=>{c&&(d.value=!0,u.value=!1,r.value=l.src)};function W(e){d.value=!1,u.value=!1,a("load",e)}function H(e){d.value=!1,u.value=!0,a("error",e)}function q(){ve(p.value,m.value)&&(V(),U())}const G=R(q,200);async function Q(){var e;if(!c)return;await g();const{scrollContainer:a}=l;K(a)?m.value=a:pe(a)&&""!==a?m.value=null!=(e=document.querySelector(a))?e:void 0:p.value&&(m.value=me(p.value)),m.value&&(_=D(m,"scroll",G),setTimeout((()=>q()),100))}function U(){c&&m.value&&G&&(null==_||_(),m.value=void 0)}function Z(e){if(e.ctrlKey)return e.deltaY<0||e.deltaY>0?(e.preventDefault(),!1):void 0}function J(){A.value&&(L=D("wheel",Z,{passive:!1}),t=document.body.style.overflow,document.body.style.overflow="hidden",f.value=!0)}function ee(){null==L||L(),document.body.style.overflow=t,f.value=!1,a("close")}function ae(e){a("switch",e)}return y((()=>l.src),(()=>{B.value?(d.value=!0,u.value=!1,U(),Q()):V()})),k((()=>{B.value?Q():V()})),(e,a)=>(w(),E("div",{ref_key:"container",ref:p,class:z([C(n).b(),e.$attrs.class]),style:$(C(N))},[void 0===r.value||u.value?j("v-if",!0):(w(),E("img",X({key:0},C(i),{src:r.value,loading:e.loading,style:C(S),class:[C(n).e("inner"),C(A)&&C(n).e("preview"),d.value&&C(n).is("loading")],onClick:J,onLoad:W,onError:H}),null,16,xe)),d.value||u.value?(w(),E("div",{key:1,class:z(C(n).e("wrapper"))},[d.value?P(e.$slots,"placeholder",{key:0},(()=>[I("div",{class:z(C(n).e("placeholder"))},null,2)])):u.value?P(e.$slots,"error",{key:1},(()=>[I("div",{class:z(C(n).e("error"))},F(C(s)("el.image.error")),3)])):j("v-if",!0)],2)):j("v-if",!0),C(A)?(w(),E(T,{key:2},[f.value?(w(),h(C(ke),{key:0,"z-index":e.zIndex,"initial-index":C(Y),infinite:e.infinite,"url-list":e.previewSrcList,"hide-on-click-modal":e.hideOnClickModal,teleported:e.previewTeleported,"close-on-press-escape":e.closeOnPressEscape,onClose:ee,onSwitch:ae},{default:O((()=>[e.$slots.viewer?(w(),E("div",Oe,[P(e.$slots,"viewer")])):j("v-if",!0)])),_:3},8,["z-index","initial-index","infinite","url-list","hide-on-click-modal","teleported","close-on-press-escape"])):j("v-if",!0)],64)):j("v-if",!0)],6))}})),[["__file","/home/runner/work/element-plus/element-plus/packages/components/image/src/image.vue"]]));export{Ie as E};
