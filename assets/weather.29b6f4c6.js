var e=Object.defineProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r;import{bE as i,c7 as n,br as s,bt as l}from"./todo.9d8ad3e1.js";import{l as c}from"./main.bc43ff04.js";import{a as m}from"./index.becf6c0c.js";import{b as u}from"./baseRequest.acdd10d1.js";import{getLocation as d}from"./baseApi.a9e27478.js";const p=m.create({timeout:5e3});p.interceptors.request.use((e=>("get"==e.method&&(e.params=((e,i)=>{for(var n in i||(i={}))a.call(i,n)&&o(e,n,i[n]);if(t)for(var n of t(i))r.call(i,n)&&o(e,n,i[n]);return e})({lang:navigator.language.split("-")[0]},e.params)),e)),(e=>{Promise.reject(e)})),p.interceptors.response.use((e=>e.data),(e=>Promise.reject(e)));const f=(e={})=>p.get("https://geoapi.qweather.com/v2/city/lookup?key=bdd98ec1d87747f3a2e8b1741a5af796",{params:e}),g=c(),b=async(e,t)=>{let a=await i.get("weather");if(!t&&a)return a;if(!e||!e.id){const{coords:t}=n();let a=null;t.value.longitude&&(a=`${t.value.longitude},${t.value.latitude}`);let r=await d({lang:"cn",coords:a});if(1==r.status)return;e=r.data||{}}let r={location:e.id},o=g.value,c=await((e={})=>u.get("/api/getWeather",{params:e}))(r);if(o=c.data,"ok"!=o.status)return void s.set("weatherAsyncTime","");let m={adm1:e.adm1,adm2:e.adm2,name:e.name,id:e.id,ip:e.ip,country:e.country,location:e.location};return o.location=m,o.moment=(({rise:e,set:t})=>{if(!e||!t)return"d";let a=l().format("YYYY-MM-DD");e=new Date(`${a} ${e}`).getTime(),t=new Date(`${a} ${t}`).getTime();let r=l().valueOf();return r>e&&r<t?"d":"n"})(o.sun||{}),o.updateTime=l().valueOf(),i.set("weather",o,12e5),g.value={daily_forecast:o.daily_forecast,location:o.location,now:o.now,moment:o.moment},o},w=async e=>{let t=await i.get("weather24H");if(!e&&t)return t;let a={location:g.value.location.id,unit:"m"},r=await((e={})=>p.get("https://devapi.qweather.com/v7/weather/24h?key=f2e14c95cfdc4a1f86ecac13ca85086b",{params:e}))(a)||{};return i.set("weather24H",r,36e5),r};var v=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",getWeather:b,getWeather24H:w});export{w as a,f as b,b as g,v as w};
