var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,n=(e,t)=>{for(var a in t||(t={}))l.call(t,a)&&o(e,a,t[a]);if(s)for(var a of s(t))r.call(t,a)&&o(e,a,t[a]);return e},i=(e,s)=>t(e,a(s));import{a4 as u,Q as c,ay as d,W as p,A as f,x as m,X as y,C as v,aF as b,D as h,V as g,U as k,b1 as w,aI as x,k as $,aE as E,bo as F,a2 as R,bp as T,I as S,b7 as _,af as j,n as C,c5 as U,aY as L,aU as O,ao as P,aA as D,u as B,$ as A,ak as N}from"./todo.9d8ad3e1.js";import{b as I,d as q,E as W,_ as H,w as M}from"./index.88f3c51b.js";import{w as K,u as X,d as z,x as V,b as J,y as Q,o as Y,A as G}from"./icon.b571cc89.js";import{u as Z,n as ee}from"./index.6fb72867.js";import{d as te,c as ae,N as se,b as le}from"./style.83568f4e.js";import{t as re,d as oe}from"./scroll.d4cf4dfc.js";import{i as ne}from"./focus-trap.50913811.js";import{m as ie}from"./typescript.72bf8adc.js";import{u as ue}from"./index.b2ab0f23.js";import{e as ce}from"./index.90c48122.js";const de=Symbol("uploadContextKey"),pe=I({type:{type:String,default:"line",values:["line","circle","dashboard"]},percentage:{type:Number,default:0,validator:e=>e>=0&&e<=100},status:{type:String,default:"",values:["","success","exception","warning"]},indeterminate:{type:Boolean,default:!1},duration:{type:Number,default:3},strokeWidth:{type:Number,default:6},strokeLinecap:{type:q(String),default:"round"},textInside:{type:Boolean,default:!1},width:{type:Number,default:126},showText:{type:Boolean,default:!0},color:{type:q([String,Array,Function]),default:""},format:{type:q(Function),default:e=>`${e}%`}}),fe=["aria-valuenow"],me={viewBox:"0 0 100 100"},ye=["d","stroke","stroke-width"],ve=["d","stroke","opacity","stroke-linecap","stroke-width"],be={key:0};const he=M(H(u(i(n({},{name:"ElProgress"}),{props:pe,setup(e){const t=e,a={success:"#13ce66",exception:"#ff4949",warning:"#e6a23c",default:"#20a0ff"},s=Z("progress"),l=c((()=>({width:`${t.percentage}%`,animationDuration:`${t.duration}s`,backgroundColor:j(t.percentage)}))),r=c((()=>(t.strokeWidth/t.width*100).toFixed(1))),o=c((()=>["circle","dashboard"].includes(t.type)?Number.parseInt(""+(50-Number.parseFloat(r.value)/2),10):0)),n=c((()=>{const e=o.value,a="dashboard"===t.type;return`\n          M 50 50\n          m 0 ${a?"":"-"}${e}\n          a ${e} ${e} 0 1 1 0 ${a?"-":""}${2*e}\n          a ${e} ${e} 0 1 1 0 ${a?"":"-"}${2*e}\n          `})),i=c((()=>2*Math.PI*o.value)),u=c((()=>"dashboard"===t.type?.75:1)),$=c((()=>`${-1*i.value*(1-u.value)/2}px`)),E=c((()=>({strokeDasharray:`${i.value*u.value}px, ${i.value}px`,strokeDashoffset:$.value}))),F=c((()=>({strokeDasharray:`${i.value*u.value*(t.percentage/100)}px, ${i.value}px`,strokeDashoffset:$.value,transition:"stroke-dasharray 0.6s ease 0s, stroke 0.6s ease, opacity ease 0.6s"}))),R=c((()=>{let e;return e=t.color?j(t.percentage):a[t.status]||a.default,e})),T=c((()=>"warning"===t.status?K:"line"===t.type?"success"===t.status?X:z:"success"===t.status?V:J)),S=c((()=>"line"===t.type?12+.4*t.strokeWidth:.111111*t.width+2)),_=c((()=>t.format(t.percentage)));const j=e=>{var a;const{color:s}=t;if(te(s))return s(e);if(ae(s))return s;{const t=function(e){const t=100/e.length;return e.map(((e,a)=>ae(e)?{color:e,percentage:(a+1)*t}:e)).sort(((e,t)=>e.percentage-t.percentage))}(s);for(const a of t)if(a.percentage>e)return a.color;return null==(a=t[t.length-1])?void 0:a.color}};return(e,t)=>(d(),p("div",{class:f([m(s).b(),m(s).m(e.type),m(s).is(e.status),{[m(s).m("without-text")]:!e.showText,[m(s).m("text-inside")]:e.textInside}]),role:"progressbar","aria-valuenow":e.percentage,"aria-valuemin":"0","aria-valuemax":"100"},["line"===e.type?(d(),p("div",{key:0,class:f(m(s).b("bar"))},[y("div",{class:f(m(s).be("bar","outer")),style:v({height:`${e.strokeWidth}px`})},[y("div",{class:f([m(s).be("bar","inner"),{[m(s).bem("bar","inner","indeterminate")]:e.indeterminate}]),style:v(m(l))},[(e.showText||e.$slots.default)&&e.textInside?(d(),p("div",{key:0,class:f(m(s).be("bar","innerText"))},[b(e.$slots,"default",{percentage:e.percentage},(()=>[y("span",null,h(m(_)),1)]))],2)):g("v-if",!0)],6)],6)],2)):(d(),p("div",{key:1,class:f(m(s).b("circle")),style:v({height:`${e.width}px`,width:`${e.width}px`})},[(d(),p("svg",me,[y("path",{class:f(m(s).be("circle","track")),d:m(n),stroke:`var(${m(s).cssVarName("fill-color-light")}, #e5e9f2)`,"stroke-width":m(r),fill:"none",style:v(m(E))},null,14,ye),y("path",{class:f(m(s).be("circle","path")),d:m(n),stroke:m(R),fill:"none",opacity:e.percentage?1:0,"stroke-linecap":e.strokeLinecap,"stroke-width":m(r),style:v(m(F))},null,14,ve)]))],6)),!e.showText&&!e.$slots.default||e.textInside?g("v-if",!0):(d(),p("div",{key:2,class:f(m(s).e("text")),style:v({fontSize:`${m(S)}px`})},[b(e.$slots,"default",{percentage:e.percentage},(()=>[e.status?(d(),k(m(W),{key:1},{default:w((()=>[(d(),k(x(m(T))))])),_:1})):(d(),p("span",be,h(m(_)),1))]))],6))],10,fe))}})),[["__file","/home/runner/work/element-plus/element-plus/packages/components/progress/src/progress.vue"]]));class ge extends Error{constructor(e,t,a,s){super(e),this.name="UploadAjaxError",this.status=t,this.method=a,this.url=s}}function ke(e,t,a){let s;return s=a.response?`${a.response.error||a.response}`:a.responseText?`${a.responseText}`:`fail to ${t.method} ${e} ${a.status}`,new ge(s,a.status,t.method,e)}const we=["text","picture","picture-card"];let xe=1;const $e=()=>Date.now()+xe++,Ee=I({action:{type:String,default:"#"},headers:{type:q(Object)},method:{type:String,default:"post"},data:{type:Object,default:()=>ie({})},multiple:{type:Boolean,default:!1},name:{type:String,default:"file"},drag:{type:Boolean,default:!1},withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},type:{type:String,default:"select"},fileList:{type:q(Array),default:()=>ie([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:we,default:"text"},httpRequest:{type:q(Function),default:e=>{"undefined"==typeof XMLHttpRequest&&re("ElUpload","XMLHttpRequest is undefined");const t=new XMLHttpRequest,a=e.action;t.upload&&t.upload.addEventListener("progress",(t=>{const a=t;a.percent=t.total>0?t.loaded/t.total*100:0,e.onProgress(a)}));const s=new FormData;if(e.data)for(const[r,o]of Object.entries(e.data))Array.isArray(o)?s.append(r,...o):s.append(r,o);s.append(e.filename,e.file,e.file.name),t.addEventListener("error",(()=>{e.onError(ke(a,e,t))})),t.addEventListener("load",(()=>{if(t.status<200||t.status>=300)return e.onError(ke(a,e,t));e.onSuccess(function(e){const t=e.responseText||e.response;if(!t)return t;try{return JSON.parse(t)}catch(a){return t}}(t))})),t.open(e.method,a,!0),e.withCredentials&&"withCredentials"in t&&(t.withCredentials=!0);const l=e.headers||{};if(l instanceof Headers)l.forEach(((e,a)=>t.setRequestHeader(a,e)));else for(const[r,o]of Object.entries(l))ne(o)||t.setRequestHeader(r,String(o));return t.send(s),t}},disabled:Boolean,limit:Number}),Fe=I(i(n({},Ee),{beforeUpload:{type:q(Function),default:se},beforeRemove:{type:q(Function)},onRemove:{type:q(Function),default:se},onChange:{type:q(Function),default:se},onPreview:{type:q(Function),default:se},onSuccess:{type:q(Function),default:se},onProgress:{type:q(Function),default:se},onError:{type:q(Function),default:se},onExceed:{type:q(Function),default:se}})),Re=I({files:{type:q(Array),default:()=>ie([])},disabled:{type:Boolean,default:!1},handlePreview:{type:q(Function),default:se},listType:{type:String,values:we,default:"text"}}),Te=["onKeydown"],Se=["src"],_e=["onClick"],je=["onClick"],Ce=["onClick"];var Ue=H(u(i(n({},{name:"ElUploadList"}),{props:Re,emits:{remove:e=>!!e},setup(e,{emit:t}){const a=e,{t:s}=ue(),l=Z("upload"),r=Z("icon"),o=Z("list"),n=$(!1),i=e=>{t("remove",e)};return(e,t)=>(d(),k(_,{tag:"ul",class:f([m(l).b("list"),m(l).bm("list",e.listType),m(l).is("disabled",e.disabled)]),name:m(o).b()},{default:w((()=>[(d(!0),p(S,null,E(e.files,(o=>(d(),p("li",{key:o.uid||o.name,class:f([m(l).be("list","item"),m(l).is(o.status),{focusing:n.value}]),tabindex:"0",onKeydown:F((t=>!e.disabled&&i(o)),["delete"]),onFocus:t[0]||(t[0]=e=>n.value=!0),onBlur:t[1]||(t[1]=e=>n.value=!1),onClick:t[2]||(t[2]=e=>n.value=!1)},[b(e.$slots,"default",{file:o},(()=>["picture"===e.listType||"uploading"!==o.status&&"picture-card"===e.listType?(d(),p("img",{key:0,class:f(m(l).be("list","item-thumbnail")),src:o.url,alt:""},null,10,Se)):g("v-if",!0),"picture"===e.listType||"uploading"!==o.status&&"picture-card"===e.listType?g("v-if",!0):(d(),p("div",{key:1,class:f(m(l).be("list","item-info"))},[y("a",{class:f(m(l).be("list","item-name")),onClick:T((e=>(e=>{a.handlePreview(e)})(o)),["prevent"])},[R(m(W),{class:f(m(r).m("document"))},{default:w((()=>[R(m(Q))])),_:1},8,["class"]),y("span",{class:f(m(l).be("list","item-file-name"))},h(o.name),3)],10,_e),"uploading"===o.status?(d(),k(m(he),{key:0,type:"picture-card"===e.listType?"circle":"line","stroke-width":"picture-card"===e.listType?6:2,percentage:Number(o.percentage),style:v("picture-card"===e.listType?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):g("v-if",!0)],2)),y("label",{class:f(m(l).be("list","item-status-label"))},["text"===e.listType?(d(),k(m(W),{key:0,class:f([m(r).m("upload-success"),m(r).m("circle-check")])},{default:w((()=>[R(m(X))])),_:1},8,["class"])):["picture-card","picture"].includes(e.listType)?(d(),k(m(W),{key:1,class:f([m(r).m("upload-success"),m(r).m("check")])},{default:w((()=>[R(m(V))])),_:1},8,["class"])):g("v-if",!0)],2),e.disabled?g("v-if",!0):(d(),k(m(W),{key:2,class:f(m(r).m("close")),onClick:e=>i(o)},{default:w((()=>[R(m(J))])),_:2},1032,["class","onClick"])),g(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),g(" This is a bug which needs to be fixed "),g(" TODO: Fix the incorrect navigation interaction "),e.disabled?g("v-if",!0):(d(),p("i",{key:3,class:f(m(r).m("close-tip"))},h(m(s)("el.upload.deleteTip")),3)),"picture-card"===e.listType?(d(),p("span",{key:4,class:f(m(l).be("list","item-actions"))},[y("span",{class:f(m(l).be("list","item-preview")),onClick:t=>e.handlePreview(o)},[R(m(W),{class:f(m(r).m("zoom-in"))},{default:w((()=>[R(m(Y))])),_:1},8,["class"])],10,je),e.disabled?g("v-if",!0):(d(),p("span",{key:0,class:f(m(l).be("list","item-delete")),onClick:e=>i(o)},[R(m(W),{class:f(m(r).m("delete"))},{default:w((()=>[R(m(G))])),_:1},8,["class"])],10,Ce))],2)):g("v-if",!0)]))],42,Te)))),128)),b(e.$slots,"append")])),_:3},8,["class","name"]))}})),[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-list.vue"]]);const Le=I({disabled:{type:Boolean,default:!1}}),Oe={file:e=>le(e)},Pe=["onDrop","onDragover"];var De=H(u(i(n({},{name:"ElUploadDrag"}),{props:Le,emits:Oe,setup(e,{emit:t}){const a=e,s=j(de);s||re("ElUploadDrag","usage: <el-upload><el-upload-dragger /></el-upload>");const l=Z("upload"),r=$(!1),o=e=>{if(a.disabled)return;r.value=!1;const l=Array.from(e.dataTransfer.files),o=s.accept.value;if(!o)return void t("file",l);const n=l.filter((e=>{const{type:t,name:a}=e,s=a.includes(".")?`.${a.split(".").pop()}`:"",l=t.replace(/\/.*$/,"");return o.split(",").map((e=>e.trim())).filter((e=>e)).some((e=>e.startsWith(".")?s===e:/\/\*$/.test(e)?l===e.replace(/\/\*$/,""):!!/^[^/]+\/[^/]+$/.test(e)&&t===e))}));t("file",n)},n=()=>{a.disabled||(r.value=!0)};return(e,t)=>(d(),p("div",{class:f([m(l).b("dragger"),m(l).is("dragover",r.value)]),onDrop:T(o,["prevent"]),onDragover:T(n,["prevent"]),onDragleave:t[0]||(t[0]=T((e=>r.value=!1),["prevent"]))},[b(e.$slots,"default")],42,Pe))}})),[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-dragger.vue"]]);const Be=I(i(n({},Ee),{beforeUpload:{type:q(Function),default:se},onRemove:{type:q(Function),default:se},onStart:{type:q(Function),default:se},onSuccess:{type:q(Function),default:se},onProgress:{type:q(Function),default:se},onError:{type:q(Function),default:se},onExceed:{type:q(Function),default:se}})),Ae=["onKeydown"],Ne=["name","multiple","accept"];var Ie=H(u(i(n({},{name:"ElUploadContent",inheritAttrs:!1}),{props:Be,setup(e,{expose:t}){const a=e,s=Z("upload"),l=C({}),r=C(),o=e=>{if(0===e.length)return;const{autoUpload:t,limit:s,fileList:l,multiple:r,onStart:o,onExceed:i}=a;if(s&&l.length+e.length>s)i(e,l);else{r||(e=e.slice(0,1));for(const a of e){const e=a;e.uid=$e(),o(e),t&&n(e)}}},n=async e=>{if(r.value.value="",!a.beforeUpload)return i(e);let t;try{t=await a.beforeUpload(e)}catch(l){t=!1}if(!1===t)return void a.onRemove(e);let s=e;t instanceof Blob&&(s=t instanceof File?t:new File([t],e.name,{type:e.type})),i(Object.assign(s,{uid:e.uid}))},i=e=>{const{headers:t,data:s,method:r,withCredentials:o,name:n,action:i,onProgress:u,onSuccess:c,onError:d,httpRequest:p}=a,{uid:f}=e,m={headers:t||{},withCredentials:o,file:e,data:s,method:r,filename:n,action:i,onProgress:t=>{u(t,e)},onSuccess:t=>{c(t,e),delete l.value[f]},onError:t=>{d(t,e),delete l.value[f]}},y=p(m);l.value[f]=y,y instanceof Promise&&y.then(m.onSuccess,m.onError)},u=e=>{const t=e.target.files;t&&o(Array.from(t))},c=()=>{a.disabled||(r.value.value="",r.value.click())},v=()=>{c()};return t({abort:e=>{ee(l.value).filter(e?([t])=>String(e.uid)===t:()=>!0).forEach((([e,t])=>{t instanceof XMLHttpRequest&&t.abort(),delete l.value[e]}))},upload:n}),(e,t)=>(d(),p("div",{class:f([m(s).b(),m(s).m(e.listType),m(s).is("drag",e.drag)]),tabindex:"0",onClick:c,onKeydown:F(T(v,["self"]),["enter","space"])},[e.drag?(d(),k(De,{key:0,disabled:e.disabled,onFile:o},{default:w((()=>[b(e.$slots,"default")])),_:3},8,["disabled"])):b(e.$slots,"default",{key:1}),y("input",{ref_key:"inputRef",ref:r,class:f(m(s).e("input")),name:e.name,multiple:e.multiple,accept:e.accept,type:"file",onChange:u,onClick:t[0]||(t[0]=T((()=>{}),["stop"]))},null,42,Ne)],42,Ae))}})),[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-content.vue"]]);const qe=(e,t)=>{const a=U(e,"fileList",void 0,{passive:!0}),s=e=>a.value.find((t=>t.uid===e.uid));function l(e){var a;null==(a=t.value)||a.abort(e)}return L((()=>e.listType),(t=>{"picture-card"!==t&&"picture"!==t||(a.value=a.value.map((t=>{const{raw:s,url:l}=t;if(!l&&s)try{t.url=URL.createObjectURL(s)}catch(r){e.onError(r,t,a.value)}return t})))})),L(a,(e=>{for(const t of e)t.uid||(t.uid=$e()),t.status||(t.status="success")}),{immediate:!0,deep:!0}),{uploadFiles:a,abort:l,clearFiles:function(e=["ready","uploading","success","fail"]){a.value=a.value.filter((t=>!e.includes(t.status)))},handleError:(t,l)=>{const r=s(l);r&&(console.error(t),r.status="fail",a.value.splice(a.value.indexOf(r),1),e.onError(t,r,a.value),e.onChange(r,a.value))},handleProgress:(t,l)=>{const r=s(l);r&&(e.onProgress(t,r,a.value),r.status="uploading",r.percentage=Math.round(t.percent))},handleStart:t=>{const s={name:t.name,percentage:0,status:"ready",size:t.size,raw:t,uid:t.uid};if("picture-card"===e.listType||"picture"===e.listType)try{s.url=URL.createObjectURL(t)}catch(l){oe("ElUpload",l.message),e.onError(l,s,a.value)}a.value.push(s),e.onChange(s,a.value)},handleSuccess:(t,l)=>{const r=s(l);r&&(r.status="success",r.response=t,e.onSuccess(t,r,a.value),e.onChange(r,a.value))},handleRemove:async t=>{const r=t instanceof File?s(t):t;r||re("ElUpload","file to be removed not found");const o=t=>{l(t);const s=a.value;s.splice(s.indexOf(t),1),e.onRemove(t,s),(e=>{var t;(null==(t=e.url)?void 0:t.startsWith("blob:"))&&URL.revokeObjectURL(e.url)})(t)};if(e.beforeRemove){!1!==await e.beforeRemove(r,a.value)&&o(r)}else o(r)},submit:function(){a.value.filter((({status:e})=>"ready"===e)).forEach((({raw:e})=>{var a;return e&&(null==(a=t.value)?void 0:a.upload(e))}))}}};const We=M(H(u(i(n({},{name:"ElUpload"}),{props:Fe,setup(e,{expose:t}){const a=e,s=O(),l=ce(),r=C(),{abort:o,submit:u,clearFiles:f,uploadFiles:y,handleStart:v,handleError:h,handleRemove:x,handleSuccess:$,handleProgress:E}=qe(a,r),F=c((()=>"picture-card"===a.listType)),R=c((()=>i(n({},a),{onStart:v,onProgress:E,onSuccess:$,onError:h,onRemove:x})));return P((()=>{y.value.forEach((({url:e})=>{(null==e?void 0:e.startsWith("blob:"))&&URL.revokeObjectURL(e)}))})),D(de,{accept:B(a,"accept")}),t({abort:o,submit:u,clearFiles:f,handleStart:v,handleRemove:x}),(e,t)=>(d(),p("div",null,[m(F)&&e.showFileList?(d(),k(Ue,{key:0,disabled:m(l),"list-type":e.listType,files:m(y),"handle-preview":e.onPreview,onRemove:m(x)},A({append:w((()=>["picture-card"===e.listType?(d(),k(Ie,N({key:0,ref_key:"uploadRef",ref:r},m(R)),{default:w((()=>[m(s).trigger?b(e.$slots,"trigger",{key:0}):g("v-if",!0),!m(s).trigger&&m(s).default?b(e.$slots,"default",{key:1}):g("v-if",!0)])),_:3},16)):g("v-if",!0)])),_:2},[e.$slots.file?{name:"default",fn:w((({file:t})=>[b(e.$slots,"file",{file:t})]))}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):g("v-if",!0),"picture-card"!==e.listType?(d(),k(Ie,N({key:1,ref_key:"uploadRef",ref:r},m(R)),{default:w((()=>[m(s).trigger?b(e.$slots,"trigger",{key:0}):g("v-if",!0),!m(s).trigger&&m(s).default?b(e.$slots,"default",{key:1}):g("v-if",!0)])),_:3},16)):g("v-if",!0),e.$slots.trigger?b(e.$slots,"default",{key:2}):g("v-if",!0),b(e.$slots,"tip"),!m(F)&&e.showFileList?(d(),k(Ue,{key:3,disabled:m(l),"list-type":e.listType,files:m(y),"handle-preview":e.onPreview,onRemove:m(x)},A({_:2},[e.$slots.file?{name:"default",fn:w((({file:t})=>[b(e.$slots,"file",{file:t})]))}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):g("v-if",!0)]))}})),[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload.vue"]]));export{We as E};
