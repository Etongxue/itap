var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,n=(a,l,o)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[l]=o,r=(e,a)=>{for(var l in a||(a={}))t.call(a,l)&&n(e,l,a[l]);if(o)for(var l of o(a))s.call(a,l)&&n(e,l,a[l]);return e};import{a4 as i,ay as d,U as c,a2 as u,bu as p,W as m,X as f,I as g,aE as h,aB as v,az as b,A as w,r as y,k as _,b1 as x,x as k,bo as V,bp as I,a1 as T,br as C,Q as j,b_ as A,aw as P,D as E,b3 as q,bn as D,aS as U,V as z,bs as S,ac as F,bf as L}from"./todo.9d8ad3e1.js";/* empty css             *//* empty css                  */import{E as O}from"./el-dialog.78f7c2e8.js";/* empty css                   *//* empty css                 */import{E as B,a as R}from"./el-form-item.a30a099f.js";import{E as K}from"./el-radio.fafbbf94.js";import{a as M}from"./index.cf2b56e1.js";import{u as Q,b as H}from"./baseRequest.acdd10d1.js";import{A as W}from"./public-api.2bc03c02.js";import{SAVE_CONFIG as X}from"./save_config.acf4dfbd.js";import{E as G}from"./index.469ed053.js";import{ElButton as J}from"./index.7243f2d8.js";/* empty css                   */import{d as N}from"./main.bc43ff04.js";import{ElMessage as Y}from"./index.8c1ac3e2.js";import{E as Z}from"./el-image-viewer.373c54a1.js";import{R as $}from"./Refresh.84dfc6ef.js";var ee=i({name:"Lock"});const ae={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},le=u("path",{fill:"currentColor",d:"M224 448a32 32 0 0 0-32 32v384a32 32 0 0 0 32 32h576a32 32 0 0 0 32-32V480a32 32 0 0 0-32-32H224zm0-64h576a96 96 0 0 1 96 96v384a96 96 0 0 1-96 96H224a96 96 0 0 1-96-96V480a96 96 0 0 1 96-96z"},null,-1),oe=u("path",{fill:"currentColor",d:"M512 544a32 32 0 0 1 32 32v192a32 32 0 1 1-64 0V576a32 32 0 0 1 32-32zm192-160v-64a192 192 0 1 0-384 0v64h384zM512 64a256 256 0 0 1 256 256v128H256V320A256 256 0 0 1 512 64z"},null,-1);ee.render=function(e,a,l,o,t,s){return d(),c("svg",ae,[le,oe])},ee.__file="packages/components/Lock.vue";var te=ee,se=i({name:"User"});const ne={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},re=u("path",{fill:"currentColor",d:"M512 512a192 192 0 1 0 0-384 192 192 0 0 0 0 384zm0 64a256 256 0 1 1 0-512 256 256 0 0 1 0 512zm320 320v-96a96 96 0 0 0-96-96H288a96 96 0 0 0-96 96v96a32 32 0 1 1-64 0v-96a160 160 0 0 1 160-160h448a160 160 0 0 1 160 160v96a32 32 0 1 1-64 0z"},null,-1);se.render=function(e,a,l,o,t,s){return d(),c("svg",ne,[re])},se.__file="packages/components/User.vue";var ie=se;const de="function"==typeof btoa,ce="function"==typeof Buffer;"function"==typeof TextDecoder&&new TextDecoder;const ue="function"==typeof TextEncoder?new TextEncoder:void 0,pe=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=");(e=>{let a={};pe.forEach(((e,l)=>a[e]=l))})();const me=String.fromCharCode.bind(String);"function"==typeof Uint8Array.from&&Uint8Array.from.bind(Uint8Array);const fe=de?e=>btoa(e):ce?e=>Buffer.from(e,"binary").toString("base64"):e=>{let a,l,o,t,s="";const n=e.length%3;for(let r=0;r<e.length;){if((l=e.charCodeAt(r++))>255||(o=e.charCodeAt(r++))>255||(t=e.charCodeAt(r++))>255)throw new TypeError("invalid character found");a=l<<16|o<<8|t,s+=pe[a>>18&63]+pe[a>>12&63]+pe[a>>6&63]+pe[63&a]}return n?s.slice(0,n-3)+"===".substring(n):s},ge=ce?e=>Buffer.from(e).toString("base64"):e=>{let a=[];for(let l=0,o=e.length;l<o;l+=4096)a.push(me.apply(null,e.subarray(l,l+4096)));return fe(a.join(""))},he=e=>{if(e.length<2)return(a=e.charCodeAt(0))<128?e:a<2048?me(192|a>>>6)+me(128|63&a):me(224|a>>>12&15)+me(128|a>>>6&63)+me(128|63&a);var a=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return me(240|a>>>18&7)+me(128|a>>>12&63)+me(128|a>>>6&63)+me(128|63&a)},ve=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,be=ce?e=>Buffer.from(e,"utf8").toString("base64"):ue?e=>ge(ue.encode(e)):e=>fe(e.replace(ve,he)),we=(e,a=!1)=>a?(e=>e.replace(/=/g,"").replace(/[+\/]/g,(e=>"+"==e?"-":"_")))(be(e)):be(e);const ye={class:"d-flex-between login-third mt15"},_e=(e=>(v("data-v-6b5e5fba"),e=e(),b(),e))((()=>f("div",null,"第三方账号登录",-1))),xe={class:"d-flex"},ke=["href","onClick"],Ve=["src"];var Ie=p({__name:"loginThird",emits:["loginThird"],setup(e,{emit:a}){const l=[{url:"https://api.weibo.com/oauth2/authorize?client_id=3805380913&redirect_uri=https://www.codelife.cc/logincb&response_type=code&state=&scope=all",icon:"weibo"},{url:"https://graph.qq.com/oauth2.0/show?which=Login&display=pc&response_type=code&client_id=101983660&redirect_uri=https%3A%2F%2Fwww.codelife.cc%2Flogincb&state=qq",icon:"qq"},{url:"https://github.com/login/oauth/authorize?client_id=930860aee1b7c1ce56ee&scope=user",icon:"github"}];return(e,o)=>(d(),m("div",ye,[_e,f("div",xe,[(d(),m(g,null,h(l,(e=>f("span",{href:e.url,key:e.icon,onClick:l=>(e=>{window.open(e.url,"_blank","width=800,height=500"),window.addEventListener("message",(e=>{let l=e.data||{};a("loginThird",l)}),!1)})(e)},[f("img",{style:{width:"24px",height:"24px"},src:`./login/${e.icon}.svg`},null,8,Ve)],8,ke))),64))])]))}},[["__scopeId","data-v-6b5e5fba"]]);const Te=e=>(v("data-v-59dce5ef"),e=e(),b(),e),Ce=[Te((()=>f("span",{class:"brid-body"},null,-1))),Te((()=>f("span",{class:"brid-claw left"},null,-1))),Te((()=>f("span",{class:"brid-claw right"},null,-1)))];var je=p({__name:"noPassword",props:{inputPass:{type:Boolean,defautl:!1}},setup(e){const a=e;return(e,l)=>(d(),m("div",null,[f("div",{class:w(["login-bird",{password:a.inputPass}])},Ce,2)]))}},[["__scopeId","data-v-59dce5ef"]]);const Ae=e=>(v("data-v-1082da27"),e=e(),b(),e),Pe=Ae((()=>f("div",{class:"ar",style:{margin:"-15px 0 10px 0"}},[f("a",{class:"d-main f12",target:"_blank",href:"https://codelife.cc/account/pass?type=find"},"忘记密码")],-1))),Ee=T("立即登录"),qe=Ae((()=>f("div",null,[f("h2",{class:"ac f18 mb10 pt30"},"选择账号数据")],-1))),De=Ae((()=>f("p",{class:"f12 d-sub ac"},"检测到云端数据和本地数据不一致，请选择使用其中某一项数据",-1))),Ue={style:{padding:"20px 40px 40px"}},ze=T("使用本地数据"),Se=T("使用云端数据"),Fe={class:"ac mt30"},Le=T("确定");var Oe=p({__name:"login",emits:["close"],setup(e,{expose:a,emit:l}){const o=Q(),t=y({email:"",password:""}),s=y({loading:!1,userInfo:{},selectDataVisible:!1,dataActive:2,isInputPass:!1}),n=_(null),r=()=>{s.loading=!0;let e={};e.email=t.email,e.from="itab",e.password=we(t.password),e.t=(new Date).getTime(),M.userLogin(e).then((e=>{200==e.code&&i(e)})).finally((()=>{s.loading=!1}))};function i(e){if(s.userInfo=e.data||{},!e.token)return;s.userInfo.token=e.token;let a=!1;s.userInfo.upTime&&(a=!0);for(let l in s.userInfo.itabAsyncTime)1!=s.userInfo.itabAsyncTime[l]&&(a=!0);a?s.selectDataVisible=!0:(o.value=s.userInfo,C.set("token",s.userInfo.token),l("close"))}function c(){o.value=s.userInfo,C.set("token",s.userInfo.token),2==s.dataActive?W(null,s.userInfo.itabAsyncTime):X(null),s.selectDataVisible=!1,l("close")}return a({loginSuccess:i}),(e,a)=>(d(),m("div",null,[u(je,{inputPass:s.isInputPass},null,8,["inputPass"]),u(k(R),{onSubmit:a[4]||(a[4]=I((()=>{}),["prevent"])),size:"large",model:t,ref_key:"refLoginForm",ref:n,"label-position":"right"},{default:x((()=>[u(k(B),{prop:"email",rules:{required:!0,type:"email",message:"邮箱格式不正确"}},{default:x((()=>[u(k(G),{"prefix-icon":k(ie),maxlength:"40",modelValue:t.email,"onUpdate:modelValue":a[0]||(a[0]=e=>t.email=e),placeholder:"请输入邮箱"},null,8,["prefix-icon","modelValue"])])),_:1}),u(k(B),{prop:"password",rules:{required:!0,message:"密码不能为空"}},{default:x((()=>[u(k(G),{onKeydown:V(r,["enter"]),maxlength:"20","show-password":"","prefix-icon":k(te),type:"password",modelValue:t.password,"onUpdate:modelValue":a[1]||(a[1]=e=>t.password=e),onFocus:a[2]||(a[2]=e=>s.isInputPass=!0),onBlur:a[3]||(a[3]=e=>s.isInputPass=!1),placeholder:"请输入6-18位密码"},null,8,["onKeydown","prefix-icon","modelValue"])])),_:1}),Pe,u(k(J),{round:"",onClick:r,type:"primary",class:"wfull",loading:s.loading},{default:x((()=>[Ee])),_:1},8,["loading"])])),_:1},8,["model"]),u(k(O),{"append-to-body":!0,width:"400px","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,modelValue:s.selectDataVisible,"onUpdate:modelValue":a[7]||(a[7]=e=>s.selectDataVisible=e)},{default:x((()=>[qe,De,f("div",Ue,[f("p",null,[u(k(K),{modelValue:s.dataActive,"onUpdate:modelValue":a[5]||(a[5]=e=>s.dataActive=e),label:1},{default:x((()=>[ze])),_:1},8,["modelValue"])]),f("p",null,[u(k(K),{modelValue:s.dataActive,"onUpdate:modelValue":a[6]||(a[6]=e=>s.dataActive=e),label:2},{default:x((()=>[Se])),_:1},8,["modelValue"])]),f("p",Fe,[u(k(J),{onClick:c,class:"wfull",type:"primary"},{default:x((()=>[Le])),_:1})])])])),_:1},8,["modelValue"])]))}},[["__scopeId","data-v-1082da27"]]);const Be={class:"d-flex-between wfull"},Re=T("立即注册 "),Ke={__name:"register",emits:["close"],setup(e,{emit:o}){const t=Q(),s=y({timer:null,loading:!1,timerText:"获取验证码",setp:0,isInputPass:!1}),n=y({email:"",username:"",password:"",verifyKey:"",source:N()}),i=_(null);const c=j((()=>!A(n.email)));j((()=>!A(n.email)));const p=()=>{A(n.email)?(s.timerText=10,s.timer=setInterval((()=>{s.timerText--,s.timerText<=0&&(clearInterval(s.timer),s.timerText="获取验证码")}),1e3),M.userSendVerifyCode({email:n.email}).then((e=>{Y.success("验证码发送成功")}))):Y.warning("请输入正确的邮箱")};function g(){i.value.validate((e=>{if(!e)return;s.loading=!0;let i=(d=r({},n),c={password:we(n.password)},a(d,l(c)));var d,c;i.t=(new Date).getTime(),M.userRegistry(i).then((e=>{let a=e.data||{};t.value=a,C.set("token",e.token),Y.success("注册成功"),o("close")})).finally((()=>{s.loading=!1}))}))}return P((()=>{clearInterval(s.timer)})),(e,a)=>(d(),m("div",null,[u(je,{inputPass:s.isInputPass},null,8,["inputPass"]),u(k(R),{onSubmit:a[6]||(a[6]=I((()=>{}),["prevent"])),size:"default",model:n,ref_key:"refLoginForm",ref:i,"label-position":"right"},{default:x((()=>[u(k(B),{prop:"email",rules:{required:!0,type:"email",message:"邮箱格式不正确"}},{default:x((()=>[f("div",Be,[u(k(G),{autocomplete:"off",maxlength:"40",modelValue:n.email,"onUpdate:modelValue":a[0]||(a[0]=e=>n.email=e),modelModifiers:{trim:!0},placeholder:"请输入邮箱"},null,8,["modelValue"]),u(k(J),{style:{width:"90px"},type:"primary",class:"ml5",disabled:k(c)||"获取验证码"!=s.timerText,onClick:p},{default:x((()=>[T(E(s.timerText),1)])),_:1},8,["disabled"])])])),_:1}),u(k(B),{prop:"verifyKey",rules:{required:!0,message:"验证码不能为空"}},{default:x((()=>[u(k(G),{autocomplete:"off",maxlength:"6",modelValue:n.verifyKey,"onUpdate:modelValue":a[1]||(a[1]=e=>n.verifyKey=e),placeholder:"请输入6位邮箱验证码"},null,8,["modelValue"])])),_:1}),u(k(B),{prop:"username",rules:{required:!0,message:"请输入用户名"}},{default:x((()=>[u(k(G),{autocomplete:"off",maxlength:"18",modelValue:n.username,"onUpdate:modelValue":a[2]||(a[2]=e=>n.username=e),modelModifiers:{trim:!0},placeholder:"请输入用户名"},null,8,["modelValue"])])),_:1}),u(k(B),{prop:"password",rules:{required:!0,message:"密码不能为空"}},{default:x((()=>[u(k(G),{autocomplete:"off",maxlength:"20","show-password":"",type:"password",onFocus:a[3]||(a[3]=e=>s.isInputPass=!0),onBlur:a[4]||(a[4]=e=>s.isInputPass=!1),modelValue:n.password,"onUpdate:modelValue":a[5]||(a[5]=e=>n.password=e),placeholder:"请输入8-18密码"},null,8,["modelValue"])])),_:1}),u(k(J),{size:"large",round:"",loading:s.loading,onClick:g,type:"primary",class:"wfull"},{default:x((()=>[Re])),_:1},8,["loading"])])),_:1},8,["model"])]))}};const Me=e=>(v("data-v-2d29e847"),e=e(),b(),e),Qe={class:"login-wechat ac"},He=Me((()=>f("img",{class:"wechat-logo",src:"./login/wechat.svg"},null,-1))),We=Me((()=>f("p",null,"微信登陆",-1))),Xe={class:"wechat-qrcode"},Ge=Me((()=>f("p",{class:"ac mb20"},[T(" 打开微信 "),f("b",{calss:"b"},"扫一扫"),T("， "),f("b",{calss:"b"},"关注公众号"),T("后即可登录/注册 ")],-1))),Je=Me((()=>f("p",{class:"ac mt20 f16"},[f("b",null,"绑定邮箱")],-1))),Ne={class:"login-tabs d-flex ac mb10"},Ye=["onClick"],Ze=Me((()=>f("div",{class:"ar",style:{margin:"-15px 0 10px 0"}},[f("a",{class:"d-main f12",target:"_blank",href:"https://codelife.cc/account/pass?type=find"},"忘记密码")],-1))),$e=T("立即登录");var ea=p({__name:"wechatLogin",emits:["loginThird"],setup(e,{emit:a}){const l=_([{name:"绑定老用户",key:"old"},{name:"绑定新用户",key:"new"}]),o=y({loading:!1,isQRcodeExpire:!1}),t=y({img:"",ticket:""}),s=_(!1),n=y({email:"",password:"",wechatOpenid:"",userType:"old"});let i=null,c=0;function p(){i&&clearInterval(i),o.isQRcodeExpire=!1,i=setInterval((()=>{t.ticket&&(c+=2,c>60&&(clearInterval(i),c=0,o.isQRcodeExpire=!0),((e={})=>H.get("/user/wechatLogin/info",{params:e}))({ticket:t.ticket}).then((e=>{e.data.success&&(clearInterval(i),e.token?a("loginThird",e):(n.wechatOpenid=e.data.wechat_openid,s.value=!0))})))}),2e3),H.get("/user/wechat/qrcode").then((e=>{let a=e.data||{};t.img=a.img,t.ticket=a.ticket}))}p(),P((()=>{i&&clearInterval(i)}));const v=()=>{o.loading=!0;let e=r({},n);e.from="itab",e.password=we(n.password),e.t=(new Date).getTime(),((e={})=>H.post("/user/wechatBindEmail",e))(e).then((e=>{200==e.code&&a("loginThird",e)})).finally((()=>{o.loading=!1}))};return(e,a)=>(d(),m("div",Qe,[q(f("span",null,[He,We,f("div",Xe,[q(f("span",{onClick:a[0]||(a[0]=e=>p()),class:"wechat-qrcode-refresh d-icon"},[u(k($))],512),[[D,o.isQRcodeExpire]]),u(k(Z),{class:"wechat-ticket",alt:"加载二维码",src:t.img},null,8,["src"])]),Ge],512),[[D,!s.value]]),q(f("span",null,[Je,f("ul",Ne,[(d(!0),m(g,null,h(l.value,(e=>(d(),m("li",{class:w(["d-cell",{active:n.userType===e.key}]),key:e.key,onClick:a=>n.userType=e.key},E(e.name),11,Ye)))),128))]),u(k(R),{onSubmit:a[3]||(a[3]=I((()=>{}),["prevent"])),size:"large",model:n,ref:"refLoginForm","label-position":"right"},{default:x((()=>[u(k(B),{prop:"email",rules:{required:!0,type:"email",message:"邮箱格式不正确"}},{default:x((()=>[u(k(G),{"prefix-icon":k(ie),maxlength:"40",modelValue:n.email,"onUpdate:modelValue":a[1]||(a[1]=e=>n.email=e),placeholder:"请输入邮箱"},null,8,["prefix-icon","modelValue"])])),_:1}),u(k(B),{prop:"password",rules:{required:!0,message:"密码不能为空"}},{default:x((()=>[u(k(G),{onKeydown:V(v,["enter"]),maxlength:"20","show-password":"","prefix-icon":k(te),type:"password",modelValue:n.password,"onUpdate:modelValue":a[2]||(a[2]=e=>n.password=e),placeholder:"请输入6-18位密码"},null,8,["onKeydown","prefix-icon","modelValue"])])),_:1}),Ze,u(k(J),{round:"",onClick:v,type:"primary",class:"mb20 wfull",loading:o.loading},{default:x((()=>[$e])),_:1},8,["loading"])])),_:1},8,["model"])],512),[[D,s.value]])]))}},[["__scopeId","data-v-2d29e847"]]);const aa={class:"app-login hfull"},la={class:"login-tabs d-flex b ac mb10"},oa=["onClick"],ta={class:"login-tip ac"},sa={key:0,class:"mt5"},na={class:"pl30 pr30 mb30"},ra={class:"ac mt5"};var ia=p({__name:"index",props:{type:String},setup(e){const a=e,l=U(),o=_(a.type),t=_(null),s=_([{name:"扫码登陆",key:"scan"},{name:"其他方式登陆",key:"other"}]),n=_("scan");const r=e=>{t.value.loginSuccess(e)};function i(){l.onClose()}return(e,a)=>(d(),c(k(O),{top:"10vh","custom-class":"login-dialog","close-on-press-escape":!1,"close-on-click-modal":!1,width:"420px"},{default:x((()=>[f("div",aa,[f("ul",la,[(d(!0),m(g,null,h(s.value,(e=>(d(),m("li",{class:w(["d-cell",{active:n.value===e.key}]),key:e.key,onClick:a=>n.value=e.key},E(e.name),11,oa)))),128))]),q(u(ea,{onLoginThird:r},null,512),[[D,"scan"==n.value]]),q(f("span",null,[f("div",ta,["firefox"==k(N)()?(d(),m("p",sa,"火狐暂不支持第三方登录")):z("",!0)]),f("div",na,[q(u(Oe,{ref_key:"loginRef",ref:t,onClose:i},null,512),[[D,"login"==o.value]]),q(u(Ke,{onClose:i},null,512),[[D,"reg"==o.value]]),u(Ie,{onLoginThird:r}),f("div",ra,[T(E("login"==o.value?"还没有账号":" 已有账号？")+" ",1),u(k(J),{text:"",onClick:a[0]||(a[0]=e=>{return a="reg"==o.value?"login":"reg",void(o.value=a);var a})},{default:x((()=>[T("立即"+E("login"==o.value?"注册":"登录"),1)])),_:1})])])],512),[[D,"other"==n.value]])])])),_:1}))}},[["__scopeId","data-v-be7db646"]]),da=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:ia}),ca=e=>{S((()=>Promise.resolve().then((function(){return da}))),void 0).then((a=>{const l=F(ia,{modelValue:!0,type:e,onClose:()=>{setTimeout((()=>{L(null,document.body)}),300)}});L(l,document.body)}))};export{ca as c};
